import{ax as i,A as a,aQ as n,z as t}from"./chunks/framework.BWRXlwpK.js";const u=JSON.parse('{"title":"Ubuntu 换源","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"linux/ubuntu/ubuntu-source.md","filePath":"linux/ubuntu/ubuntu-source.md"}'),e={name:"linux/ubuntu/ubuntu-source.md"};function l(p,s,h,k,d,F){return t(),a("div",null,s[0]||(s[0]=[n(`<h1 id="ubuntu-换源" tabindex="-1">Ubuntu 换源 <a class="header-anchor" href="#ubuntu-换源" aria-label="Permalink to &quot;Ubuntu 换源&quot;">​</a></h1><p>Ubuntu 24.04LTS后，apt 源的位置替换到了 <code>/etc/apt/sources.list.d/ubuntu.sources</code> 中。</p><p>这里可以存放多个 <code>.sources</code> 文件，每一个文件都是独立的软件源配置，文件内容种格式为 <code>DEB822格式</code>。</p><p>这也是官方推荐的方式，尤其适合：</p><ul><li>添加新的第三方源</li><li>不想修改系统默认源</li><li>分类管理源（官方源、国内镜像、PPA等）</li></ul><h2 id="创建一个-sources-文件" tabindex="-1">创建一个 .sources 文件 <a class="header-anchor" href="#创建一个-sources-文件" aria-label="Permalink to &quot;创建一个 .sources 文件&quot;">​</a></h2><p>假设你想添加 清华源（参考）：<a href="https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/" target="_blank" rel="noreferrer">https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/</a></p><p>1.新建文件</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apt/sources.list.d/tsinghua.sources</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 或</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apt/sources.list.d/tsinghua.sources</span></span></code></pre></div><p>2.添加清华源内容，可参考文档中 <code>DEB822格式</code> 部分</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Types:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deb</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">URIs:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://mirrors.tuna.tsinghua.edu.cn/ubuntu</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Suites:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> noble</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> noble-updates</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> noble-backports</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Components:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> main</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restricted</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> universe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> multiverse</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Signed-By:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/share/keyrings/ubuntu-archive-keyring.gpg</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 以下安全更新软件源包含了官方源与镜像站配置，如有需要可自行修改注释切换</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Types:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deb</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">URIs:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://security.ubuntu.com/ubuntu/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Suites:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> noble-security</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Components:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> main</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restricted</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> universe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> multiverse</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Signed-By:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/share/keyrings/ubuntu-archive-keyring.gpg</span></span></code></pre></div><p>3.保存文件后，更新软件源</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 清除缓存</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clean</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 更新软件源</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span></span></code></pre></div><h2 id="常见问题" tabindex="-1">常见问题 <a class="header-anchor" href="#常见问题" aria-label="Permalink to &quot;常见问题&quot;">​</a></h2><h3 id="_1-之前使用无法工作的源进行下载-导致对下载地址有缓存" tabindex="-1">1.之前使用无法工作的源进行下载，导致对下载地址有缓存 <a class="header-anchor" href="#_1-之前使用无法工作的源进行下载-导致对下载地址有缓存" aria-label="Permalink to &quot;1.之前使用无法工作的源进行下载，导致对下载地址有缓存&quot;">​</a></h3><p>如之前使用无法工作的源下载了 nginx，导致对下载地址有缓存，即便添加了新的源也继续以缓存的源下载。</p><p>1.查看缓存中的 nginx 的候选源</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt-cache</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> policy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span></span></code></pre></div><p>输出示例</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nginx:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Installed:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (none)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Candidate:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 1.24.0-2ubuntu7.4</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Version</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> table:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     1.24.0-2ubuntu7.4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 500</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        500</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://cn.archive.ubuntu.com/ubuntu</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> noble-updates/main</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> amd64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Packages</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     1.24.0-2ubuntu7.4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 500</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        500</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://mirrors.tuna.tsinghua.edu.cn/ubuntu</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> noble-updates/main</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> amd64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Packages</span></span></code></pre></div><p>出现这种状况可以先将 <code>.sources</code> 中废源先注释掉。</p><p>或指定某个源安装</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> noble-updates</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span></span></code></pre></div><ul><li>-t noble-updates 告诉 apt 从 noble-updates 版本查找软件</li><li>如果清华源的版本可用，就会直接从清华源下载</li></ul><h3 id="_2-noble-updates-的含义" tabindex="-1">2.noble-updates 的含义 <a class="header-anchor" href="#_2-noble-updates-的含义" aria-label="Permalink to &quot;2.noble-updates 的含义&quot;">​</a></h3><p>在 <code>.sources</code> 或传统 <code>sources.list</code> 中，每行除了源地址，还要指定：</p><ul><li>版本/套件（Suite）</li><li>组件（Components）</li></ul><p>例如:清华源 .sources 文件：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Types:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deb</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">URIs:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://mirrors.tuna.tsinghua.edu.cn/ubuntu/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Suites:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> noble</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> noble-updates</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> noble-backports</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Components:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> main</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restricted</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> universe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> multiverse</span></span></code></pre></div><p>这里：</p><ul><li>noble → Ubuntu 24.04 的基础版本包</li><li>noble-updates → 官方“常规更新”包（bug 修复、功能小升级）</li><li>noble-backports → 回移版本包（从新版本 backport 过来的功能）</li></ul><p>所以 “从 noble-updates 版本中查找软件” 就是告诉 apt：在这个套件里找软件包，而不是只看基础 noble 套件。</p><h3 id="时间错误导致的下载失败" tabindex="-1">时间错误导致的下载失败 <a class="header-anchor" href="#时间错误导致的下载失败" aria-label="Permalink to &quot;时间错误导致的下载失败&quot;">​</a></h3><p>报错信息：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Certificate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> verification</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> failed</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">The</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> certificate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chain</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> uses</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> not</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yet</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> valid</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> certificate</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Could</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> not</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> handshake</span></span></code></pre></div><p>含义：</p><ul><li>APT 尝试访问清华源 HTTPS 时，发现证书不受信任或尚未生效</li><li>not yet valid certificate → 证书的生效日期还没到，或者系统时间不对</li><li>因此 TLS 握手失败，无法下载索引</li></ul><p>解决办法</p><p>1.检查系统时间</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">date</span></span></code></pre></div><p>确保系统时间是正确的。</p><p>2.如果时间错误，手动设置时间</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> timedatectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set-timezone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Asia/Shanghai</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     # 设置时区</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> timedatectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set-ntp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                   # 启用网络时间同步</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> timedatectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                         # 查看同步状态</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如果无法同步时间，手动设置时间</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> timedatectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set-ntp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                  # 禁用网络时间同步</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> timedatectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set-time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;2024-04-01 12:00:00&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 设置时间</span></span></code></pre></div><p>3.更新 apt 缓存</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span></span></code></pre></div>`,45)]))}const c=i(e,[["render",l]]);export{u as __pageData,c as default};
